#!/bin/sh

REL="$(dirname "$0")"

JAZ="$REL/jazz"
JAM="jazz/jam"

bootstrap_init () {
	cd "$REL"
    git submodule init
}

bootstrap_update () {
	cd "$REL"
    git submodule update
}

bootstrap () {
    (bootstrap_init) &&
    (bootstrap_update)
}

bootstrap_dispatch () {
    case "$1" in
	"init" )
	    bootstrap_init
	    ;;
	"update" )
	    bootstrap_update
	    ;;
	"" )
	    bootstrap
	    ;;
	* )
	    echo "Unknown bootstrap option : $1"
	    return 1
	    ;;
    esac
}

display_info () {
	echo "Jedi"
	git log -1

	echo
	echo "Jazz"
	if [ -d "$JAZ" ]; then
		cd "$JAZ" &&
		git log -1
	fi
}

case "$1" in
	"bootstrap" )
		bootstrap_dispatch $2
		exit
		;;

	"info" )
		display_info
		exit
		;;
esac

if [ ! -f "$JAM" ]; then
	bootstrap
fi

if [ ! -f "$JAM" ]; then
	echo "Unable to find jazz/jam"
	exit 1
fi

exec "$JAM" "$@"
